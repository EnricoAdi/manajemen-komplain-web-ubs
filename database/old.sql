-- kalau pertama kali buat user dulu (login pakai system)
-- create user kp identified by kp;
-- GRANT CREATE SESSION to kp;
-- GRANT CONNECT, RESOURCE, CREATE USER, CREATE VIEW, CREATE SYNONYM, UNLIMITED TABLESPACE TO kp WITH ADMIN OPTION;

--untuk connect 
--conn kp/kp;

DROP TABLE LAMPIRAN;
DROP TABLE KOMPLAINB;
DROP TABLE KOMPLAINA;
DROP TABLE SUB_TOPIK2;
DROP TABLE SUB_TOPIK1;
DROP TABLE TOPIK;
DROP TABLE USERS;
DROP TABLE DIVISI;
DROP TABLE HAK_AKSES;


CREATE TABLE DIVISI
(
    KODE_DIVISI VARCHAR2(2) PRIMARY KEY,
    NAMA_DIVISI VARCHAR2(20), 
    AKTIF VARCHAR2(1),
    KEL_SAH VARCHAR2(2) 
);
CREATE TABLE HAK_AKSES
(
    KODE_HAK_AKSES VARCHAR2(1) PRIMARY KEY,
    NAMA_HAK_AKSES VARCHAR2(20)
);
CREATE TABLE USERS
(
    --buat sendiri
    NOMOR_INDUK VARCHAR2(8) PRIMARY KEY,
    PASSWORD VARCHAR2(200),
    NAMA VARCHAR2(30),
    KODE_HAK_AKSES VARCHAR2(1) REFERENCES HAK_AKSES(KODE_HAK_AKSES),
    EMAIL VARCHAR2(40) NULL,
    KODE_DIVISI VARCHAR2(2) REFERENCES DIVISI(KODE_DIVISI),
    KODE_ATASAN VARCHAR2(8) NULL
    --REFERENCES NOMOR INDUK ATASAN
);
CREATE TABLE TOPIK
(
    TOPIK VARCHAR2(20) NOT NULL,
    KODE_TOPIK VARCHAR2(5) PRIMARY KEY,
    DESKRIPSI VARCHAR2(200) NOT NULL,
    AU VARCHAR2(1) NOT NULL,
    DIV_TUJUAN VARCHAR2(2) REFERENCES DIVISI(KODE_DIVISI),
    NAMA VARCHAR2(50)
);

CREATE TABLE SUB_TOPIK1
(
    KODE_TOPIK VARCHAR2(5) REFERENCES TOPIK(KODE_TOPIK),
    SUB_TOPIK1 VARCHAR2(4) PRIMARY KEY,
    DESKRIPSI VARCHAR2(200)
);

CREATE TABLE SUB_TOPIK2
(
    KODE_TOPIK VARCHAR2(5) REFERENCES TOPIK(KODE_TOPIK),
    SUB_TOPIK1 VARCHAR2(4) REFERENCES SUB_TOPIK1(SUB_TOPIK1),
    SUB_TOPIK2 VARCHAR2(4) PRIMARY KEY,
    DESKRIPSI VARCHAR2(200),
    AKTIF VARCHAR2(1)
);

CREATE TABLE KOMPLAINA
(
    NO_KOMPLAIN VARCHAR2(10) PRIMARY KEY,
    TOPIK VARCHAR2(5) REFERENCES TOPIK(KODE_TOPIK),
    SUB_TOPIK1 VARCHAR2(4) REFERENCES SUB_TOPIK1(SUB_TOPIK1),
    SUB_TOPIK2 VARCHAR2(4) REFERENCES SUB_TOPIK2(SUB_TOPIK2),
    TGL_KEJADIAN DATE,
    TGL_TERBIT DATE,
    TGL_VERIFIKASI DATE NULL,
    USER_VERIFIKASI VARCHAR2(8) NULL,
    TGL_CANCEL DATE NULL,
    USER_CANCEL VARCHAR2(8) NULL,
    TGL_BANDING DATE NULL,
    USER_BANDING VARCHAR2(8) NULL,
    TGL_VALIDASI DATE NULL,
    USER_VALIDASI VARCHAR2(8) NULL,
    PENUGASAN VARCHAR2(8) NULL,
    STATUS VARCHAR2(6),
    TGL_PENANGANAN DATE NULL,
    USER_PENANGANAN VARCHAR2(8) NULL,
    TGL_DEADLINE DATE NULL,
    TGL_DONE DATE NULL,
    USER_DONE VARCHAR2(8) NULL,
    USER_PENERBIT VARCHAR2(8) 
);
--open, close, pending, cancel

CREATE TABLE KOMPLAINB --untuk feedback
(
    NO_KOMPLAIN VARCHAR2(10) REFERENCES KOMPLAINA(NO_KOMPLAIN),
    DESKRIPSI_MASALAH VARCHAR2(1000) NOT NULL,
    AKAR_MASALAH VARCHAR2(1000),
    T_KOREKTIF VARCHAR2(1000),
    T_PREVENTIF VARCHAR2(1000),
    KEBERATAN VARCHAR2(1000) 
); 
CREATE TABLE LAMPIRAN
(
    KODE_LAMPIRAN VARCHAR2(40) PRIMARY KEY,
    NO_KOMPLAIN VARCHAR2(10) REFERENCES KOMPLAINA(NO_KOMPLAIN),
    TANGGAL DATE,
    TIPE VARCHAR(1) --0 untuk komplain, 1 untuk feedback
);


--DML 
INSERT INTO DIVISI
VALUES('01', 'IT');
INSERT INTO DIVISI
VALUES('02', 'PRODUKSI');
INSERT INTO DIVISI
VALUES('03', 'VARIASI');
INSERT INTO DIVISI
VALUES('04', 'COR');
INSERT INTO DIVISI
VALUES('05', 'MARKETING');
INSERT INTO DIVISI
VALUES('06', 'ARESO');
INSERT INTO DIVISI
VALUES('07', 'ARESO');
INSERT INTO DIVISI
VALUES('08', 'ARESO');
INSERT INTO DIVISI
VALUES('09', 'ARESO');
INSERT INTO DIVISI
VALUES('10', 'ARESO');
INSERT INTO DIVISI
VALUES('11', 'ARESO');
INSERT INTO DIVISI
VALUES('12', 'ARESO');
INSERT INTO DIVISI
VALUES('13', 'ARESO');
INSERT INTO DIVISI
VALUES('14', 'ARESO');
INSERT INTO DIVISI
VALUES('15', 'ARESO');
INSERT INTO DIVISI
VALUES('16', 'ARESO');
INSERT INTO DIVISI
VALUES('17', 'ARESO');
INSERT INTO DIVISI
VALUES('18', 'ARESO');
INSERT INTO DIVISI
VALUES('19', 'ARESO');
INSERT INTO DIVISI
VALUES('20', 'ARESO');
--ada end_user, manager, direktur, admin
INSERT INTO HAK_AKSES
VALUES('1', 'End User');
INSERT INTO HAK_AKSES
VALUES('2', 'Manager');
INSERT INTO HAK_AKSES
VALUES('3', 'General Manager');
INSERT INTO HAK_AKSES
VALUES('4', 'Admin');

INSERT into users
values('12345678', '$2y$10$iAaeo2TCryN5.2rSPMAPB.bW0DrmhDbxQBR4zPoRYnGiFL30R96Rm', 'Enrico', '1', 'enricoadi49@gmail.com', '03', '12345679');
INSERT into users
values('12345679', '$2y$10$iAaeo2TCryN5.2rSPMAPB.bW0DrmhDbxQBR4zPoRYnGiFL30R96Rm', 'Enrico', '2', 'enricomanager@ubslinux.com', '03', '');
INSERT into users
values('12345680', '$2y$10$RGptyEa7CBK370RNA60NzeliRWjl6PlzyJJGQZyRAsAlhcBoUErBy', 'Ester', '1', 'ester@ubslinux.com', '01', '');
INSERT into users
values('12345681', '$2y$10$RGptyEa7CBK370RNA60NzeliRWjl6PlzyJJGQZyRAsAlhcBoUErBy', 'Ester', '2', 'estermanager@ubslinux.com', '01', '');
INSERT into users
values('admin', '$2y$10$P7qa.IhncGTaPfIiEG/MseX.MXjogMckU5WCWmLq8elUMNrfdCseS', 'Admin', '4', 
'admin1@ubslinux.com', '01', '');
INSERT into users
values('12311179', '$2y$10$iAaeo2TCryN5.2rSPMAPB.bW0DrmhDbxQBR4zPoRYnGiFL30R96Rm', 'Enrico', '2', 'enrico2@ubslinux.com', '01', '12345678');
INSERT into users values('11311180', '$2y$10$iAaeo2TCryN5.2rSPMAPB.bW0DrmhDbxQBR4zPoRYnGiFL30R96Rm', 'Enrico', '1', '', '01', '12345678');
 
INSERT INTO TOPIK VALUES ('ENVIRONMENT_PRODUKSI','E2301','LINGKUNGAN PRODUKSI','T','02','Lingkungan');
INSERT INTO TOPIK VALUES ('MORALE_IT','M2301','Moral Divisi IT','T','01','MORALE_IT');
INSERT INTO TOPIK VALUES ('QUALITY_IT','Q2301','Kualitas','T','01','Kualitas');
INSERT INTO TOPIK VALUES ('SAFETY_IT','S2301','Keamanan IT','T','01','Keamanan IT');
INSERT INTO TOPIK VALUES ('PRODUCT_PRODUKSI','P2301','Produk','T','02','Produk');
INSERT INTO TOPIK VALUES ('COST_MARKETING','C2301','Biaya','T','05','Biaya');
INSERT INTO TOPIK VALUES ('PRODUCT_VARIASI','P2302','Hasil Produk Divisi Variasi','T','03','PRODUCT_VARIASI');
INSERT INTO TOPIK VALUES ('COST_PRODUKSI','C2302','BIAYA UNTUK PROSES PRODUKSI','T','02','COST_PRODUKSI');
INSERT INTO TOPIK VALUES ('SAFETY_PRODUKSI','S2302','KEAMANAN LINGKUNGAN PRODUKSI','T','02','SAFETY_PRODUKSI');
INSERT INTO TOPIK VALUES ('COST_IT','C2303','Biaya departemen IT','T','01','COST_IT');
INSERT INTO TOPIK VALUES ('ENVIRONMENT_IT','E2302','Lingkungan kerja divisi IT','T','01','ENVIRONMENT_IT');
INSERT INTO TOPIK VALUES ('QUALITY_PRODUKSI','Q2302','Kualitas Divisi Produksi','T','02','QUALITY_PRODUKSI');
INSERT INTO TOPIK VALUES ('MORALE_COR','M2302','Moral Divisi COR','T','04','MORALE_COR');
INSERT INTO TOPIK VALUES ('MORALE_MARKETING','M2303','Moral Divisi Marketing','T','05','MORALE_MARKETING');

INSERT INTO SUB_TOPIK1 VALUES ('E2301','0008','Kebersihan Lingkungan Produksi');
INSERT INTO SUB_TOPIK1 VALUES ('M2301','0011','Sikap Kerja Divisi IT');
INSERT INTO SUB_TOPIK1 VALUES ('M2301','0004','Sikap salam Divisi IT');
INSERT INTO SUB_TOPIK1 VALUES ('Q2301','0007','Kualitas Software Divisi IT');
INSERT INTO SUB_TOPIK1 VALUES ('Q2301','0005','Kualitas Produk');
INSERT INTO SUB_TOPIK1 VALUES ('S2301','0010','Keamanan Perangkat Keras Divisi IT');
INSERT INTO SUB_TOPIK1 VALUES ('S2301','0006','Keamanan Lingkungan Kerja');
INSERT INTO SUB_TOPIK1 VALUES ('P2301','0012','Hasil Produk Divisi Produksi');
INSERT INTO SUB_TOPIK1 VALUES ('C2301','0003','Harga Kegiatan Marketing Divisi Marketing');
INSERT INTO SUB_TOPIK1 VALUES ('E2302','0013','Kondisi Ruang Divisi IT');
INSERT INTO SUB_TOPIK1 VALUES ('E2302','0002','Tata Lingkungan Divisi IT');
INSERT INTO SUB_TOPIK1 VALUES ('Q2302','0009','Kualitas Bahan Produksi');

INSERT INTO SUB_TOPIK2 VALUES ('E2301','0008','0004','LINGKUNGAN KURANG BERSIH','1');
INSERT INTO SUB_TOPIK2 VALUES ('E2301','0008','0005','LINGKUNGAN PRODUKSI SEDIKIT TIDAK BERSIH','1');
INSERT INTO SUB_TOPIK2 VALUES ('Q2301','0007','0003','BUG PADA APLIKASI PENGAJUAN LAPORAN','1');
INSERT INTO SUB_TOPIK2 VALUES ('S2301','0006','0002','Kondisi lingkungan kantor ada masalah keamanan','1');
INSERT INTO SUB_TOPIK2 VALUES ('C2301','0002','0001','RUANGAN TERLALU GELAP','1');

COMMIT; 
